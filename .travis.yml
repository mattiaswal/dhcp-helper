sudo: required

# It is not really needed, other than for showing correct language tag in Travis CI build log.
language: c
compiler:
  - gcc
  - clang
env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
- secure: "L5r2qRIdV2sYmlppYJU5WSiwIZzNEZopk9qw8Mt7HMeWiRLJW6U6xq92bK0xvnMFSHYDWJ3tNrOwrWkyDpf9mfudcn8ywLKgC1m6iJlnPZk80SMi8U4kCJTsmo2MEXjx50RR32zTLerNsurMbGG+zWoECvRtHdiDzl+orSRMRpjMUZMfRgjdWBwiDcIrJuBJSI8JZEyefKBHridR0+EreSYIjgtHSE01+VdgifVrFZCdPgphFkSh3mppe0xXW5ew0P2WArlod0f5iN9ncdqsTiUReiL5PY6T5kTfmLZnaMbB1HNfu2ymORZ3B6xjFQ1B1f1AXLEdLAKxT0CZFv1KFVasGaNWxP6M4d5jqy5c8p8AFC8WXhttKN52npbTtR0Gaw9BoCgB5STqTHhavjkkqr2vPJ/hq67FnssHLN9QMpUfHDQsyM1a0lf5pZ1HfV/SQ8Mg3Sl3szsj2KKG7hbLFiq0SPpWskAx8GUkx6+35NjBnCfOEtPEH8cSSZeUFx09WKVD0XuBReqnWiroRfsMNpixPKut1N4INxclb8XyutKdHNdDaXOwQv+KxR4pmVuJXFE18fZS6IX4BUUEqwFZC4wOynAACH51emST4fEnDyVK14g4RVVomhCgCKRYMDEaOOpUzIx+rnZ62aWnFM6Jhe1111S9P05A7Kvc3DJL0zM="

addons:
  coverity_scan:

    project:
      name: "mattiaswal/dhcp-helper"
      description: "dhcp-helper | A DHCP relay agent, with option82 support"
    notification_email: lazzer@gmail.com
    build_command_prepend: "./autogen.sh && ./configure"
    build_command: "make"
    branch_pattern: dev

before_install:
  - docker run --privileged -d --name travis-ci -v $(pwd):/travis ubuntu:xenial tail -f /dev/null
#  - docker exec -t travis-ci bash -c "echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-"
  - docker ps

install:
  - docker exec -t travis-ci bash -c "apt-get update;
    apt-get install -y libnl-3-dev libnl-3-200 libnl-route-3-200 libnl-genl-3-200 libnl-route-3-dev libnl-genl-3-dev libjansson-dev libev-dev build-essential autoconf automake pkg-config clang python-scapy tcpdump iproute2; mv /usr/sbin/tcpdump /usr/local/bin/; ln -s /usr/local/bin/tcpdump /usr/sbin/"

script:
  - docker exec -t travis-ci bash -c "cd /travis; ./autogen.sh && ./configure && make && make check"
